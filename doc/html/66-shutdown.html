<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="date" content="2020-05-08" scheme="YYYY-MM-DD" />
<meta name="author" content="Eric Vidal &lt;eric@obarun.org&gt;" />
<title>The 66 Suite: 66-shutdown</title>
</head>
<body>

<p><a href="index.html">66</a></p>

<p><a href="https://web.obarun.org">obarun.org</a></p>

<h1 id="66-shutdown">66-shutdown</h1>

<p>Triggers the system shutdown procedure. It is normally invoked as shutdown at your binary system directory. This program is a modified copy of <a href="https://skarnet.org/software/s6-linux-init/s6-linux-init-shutdown.html">s6-linux-init-shutdown</a>.</p>

<h2 id="Interface">Interface</h2>

<pre><code>    66-shutdown [ -H ] [ -l live ] [ -h | -p | -r | -k ] [ -a ] [ -t sec ] [ -f | -F ] time [ message ]
    66-shutdown -c [ message ]
</code></pre>

<ul>
<li>Will cancel a pending shutdown if <em>-c</em> is passed.</li>
<li>Else plans the shutdown procedure at time time.</li>
<li>If a message argument has been given it is broadcast to all logged in users as tracked by utmp.</li>
<li>Exits with <code>0</code>. The shutdown procedure happens asynchronously.</li>
</ul>

<p>The <em>66-shutdown</em> program abides to the standards of the LSB-3.0.0 <a href="http://refspecs.linuxbase.org/LSB_3.0.0/LSB-PDA/LSB-PDA/shutdown.html">shutdown</a> interface.</p>

<p><em>time</em> must be one of these formats: <code>[ now | [+]mins | hh:mm ]</code> where:</p>

<ul>
<li><p><em>now</em> : triggers the shutdown sequence immediately.</p></li>
<li><p><em>mins</em> or <em>+mins</em> : relative time; triggers the shutdown sequence after <em>mins</em> minutes.</p></li>
<li><p><em>hh:mm</em> : absolute time; triggers the shutdown sequence when the time <em>hh:mm</em> occurs. If that time has passed for the current day, it will wait for the next day. <em>hh</em> can have 1 or 2 digits; <em>mm</em> must have 2 digits.</p></li>
</ul>

<h2 id="Exit%20codes">Exit codes</h2>

<ul>
<li><em>0</em> success</li>
<li><em>100</em> wrong usage</li>
<li><em>111</em> system call failed</li>
</ul>

<h2 id="Options">Options</h2>

<ul>
<li><p><strong>-H</strong> : prints this help.</p></li>
<li><p><strong>-l</strong> <em>live</em> : changes the supervision directory of <em>service</em> to <em>live</em>. By default this will be <code>%%livedir%%</code>. The default can also be changed at compile time by passing the <code>--livedir=live</code> option to <code>./configure</code>. An existing absolute path is expected and should be within a writable filesystem - likely a RAM filesystemâ€”see <a href="66-scandir.html">66-scandir</a>.</p></li>
<li><p><strong>-a</strong> : access control. The shutdown sequence will only be launched if one of the users listed in <code>%%skel%%/shutdown.allow</code> is currently logged in (as tracked by utmp). <code>%%skel%%/shutdown.allow</code> is a text file which accepts one user per line. Lines starting with <code>#</code> are commented out.</p></li>
<li><p><strong>-t</strong> <em>sec</em> : have a &#8220;grace time&#8221; period of sec seconds between the <code>SIGTERM</code> and the <code>SIGKILL</code> at the end of the shutdown sequence when it is time to kill all processes (allows processes to receive <code>SIGTERM</code> to exit cleanly). Default is <code>3</code> seconds.</p></li>
<li><p><strong>-k</strong> : do not shut down; send a warning message to all logged in users.</p></li>
<li><p><strong>-h</strong> : halt the system at the end of the shutdown sequence.</p></li>
<li><p><strong>-p</strong> : power off the system at the end of the shutdown sequence. This option is provided as an extension it is not required by the LSB interface.</p></li>
<li><p><strong>-r</strong> : reboot the system at the end of the shutdown sequence.</p></li>
<li><p><strong>-f</strong> : ignored.</p></li>
<li><p><strong>-F</strong> : ignored.</p></li>
<li><p><strong>-c</strong> : cancel a planned shutdown. Can only cancel the effect of a previous call to <em>shutdown</em> with a time argument that was not <em>now</em>. This cannot be used to interrupt a shutdown sequence that has already started. </p></li>
</ul>

<h2 id="Notes">Notes</h2>

<p>The <em>66-shutdown</em> binary is not meant to be called directly. It should always be referenced by the shutdown skeleton file installed by default at <code>%%skel%%</code>. The binary <strong>should be copied</strong> or <strong>symlinked</strong> into the binary directory of the system.</p>

<p>The <strong>-f</strong> and <strong>-F</strong> exist for compatibility reasons. The LSB sepcification says they are used to advise the system to skip or enforce a <code>fsck</code> after rebooting. But they are only advisory and for decades now systems have used other methods of evaluating whether they should perform filesystem checks so these options are largely obsolete nowadays.</p>
</body>
</html>
