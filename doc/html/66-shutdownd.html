<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="date" content="2020-05-08" scheme="YYYY-MM-DD" />
<meta name="author" content="Eric Vidal &lt;eric@obarun.org&gt;" />
<title>The 66 Suite: 66-shutdownd</title>
</head>
<body>

<p><a href="index.html">66</a></p>

<p><a href="https://web.obarun.org">obarun.org</a></p>

<h1 id="66-shutdownd">66-shutdownd</h1>

<p>The daemon that manages the shutdown procedure for a <a href="66-boot.html">66-boot</a> installation. It is not meant to be called directly. This program is a modified copy of <a href="https://skarnet.org/software/s6-linux-init/s6-linux-init-shutdownd.html">s6-linux-init-shudownd</a>. </p>

<h2 id="Interface">Interface</h2>

<pre><code>    66-shutdownd [ -h ] [ -l live ] [ -s skel ] [ -g gracetime ]
</code></pre>

<ul>
<li><p>66-shutdownd opens the <code>%%livedir%%/scandir/0/shutdownd/fifo</code> pipe and listens to it. Programs such as <a href="66-shutdown.html">66-shutdown</a> send their commands to this pipe when they are told to trigger the shutdown procedure.</p></li>
<li><p>When it receives a command to shut down <em>66-shutdownd</em> parses the skel file <code>rc.init</code>—defined by default at <code>%%skel%%</code> directory— and reads the value of <code>RCSHUTDOWN</code> to be able to spawn the <code>rc.shutdown</code> script.</p></li>
<li><p>When said script exits <em>66-shutdownd</em> kills all processes first with a <code>SIGTERM</code> then, after the grace time specified by the shutdown command, with a <code>SIGKILL</code>.</p></li>
<li><p>It then runs an automatically generated script called <code>stage4</code> which unmounts all file systems and halts, powers off or reboots the machine.</p></li>
</ul>

<h2 id="Exit%20codes">Exit codes</h2>

<ul>
<li><em>0</em> success</li>
<li><em>100</em> wrong usage</li>
<li><em>111</em> system call failed</li>
</ul>

<h2 id="Options">Options</h2>

<ul>
<li><p><strong>-h</strong> : prints this help.</p></li>
<li><p><strong>-l</strong> <em>live</em> : changes the supervision directory of <em>service</em> to <em>live</em>. By default this will be <code>%%livedir%%</code>. The default can also be changed at compile time by passing the <code>--livedir=live</code> option to <code>./configure</code>. An existing absolute path is expected and should be within a writable filesystem - likely a RAM filesystem—see <a href="66-scandir.html">66-scandir</a>.</p></li>
<li><p><strong>-s</strong> <em>skel</em> : an absolute path; directory of the skeleton file <code>rc.init</code>. Default is <code>%%skel%%</code>.</p></li>
<li><p><strong>-g</strong> <em>gracetime</em> : specify a grace time between the <code>SIGTERM</code> and the <code>SIGKILL</code> in milliseconds if the shutdown command does not provide one. Defaults to <code>3000</code>.</p></li>
</ul>

<h2 id="Note">Note</h2>

<p>The <em>66-shutdownd</em> binary is not meant to be called directly. It is automatically generated by a <a href="66%E2%80%91scandir.html">66-scandir</a> program invocation.</p>
</body>
</html>
