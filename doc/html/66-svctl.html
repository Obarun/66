<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="date" content="2020-05-08" scheme="YYYY-MM-DD" />
<meta name="author" content="Eric Vidal &lt;eric@obarun.org&gt;" />
<title>The 66 Suite: 66-svctl</title>
</head>
<body>

<p><a href="index.html">66</a></p>

<p><a href="https://web.obarun.org">obarun.org</a></p>

<h1 id="66-svctl">66-svctl</h1>

<p>Controls an already supervised <em>service</em> at live defined in a <em>tree</em>.</p>

<h2 id="Interface">Interface</h2>

<pre><code>    66-svctl [ -h ] [ -z ] [ -v verbosity ] [ -l live ] [ -t tree ] [ -T timeout ] [ -n death ] [ -u | d | r | K | X ] service(s)
</code></pre>

<p>This tool expects to find an already supervised <em>service</em> at <em>live</em> defined in the given <em>tree</em> and an already running <a href="66-scandir.html">scandir</a>.</p>

<p><strong><em>(!)</em></strong> This tool only deals with <code>classic</code> services—see <a href="66-dbctl.html">66‑dbctl</a> for other types of services.</p>

<p>Multiple <em>services</em> can be handled by separating their names with a space. <em>66‑svctl</em> gathers each of these services in a list called <em>selection</em>. The command is sent to the <em>selection</em> asynchronously. </p>

<h2 id="Exit%20codes">Exit codes</h2>

<ul>
<li><em>0</em> success</li>
<li><em>100</em> wrong usage</li>
<li><em>111</em> system call failed</li>
</ul>

<h2 id="Options">Options</h2>

<ul>
<li><p><strong>-h</strong> : prints this help.</p></li>
<li><p><strong>-z</strong> : use color.</p></li>
<li><p><strong>-v</strong> <em>verbosity</em> : increases/decreases the verbosity of the command.</p>

<ul>
<li><em>1</em> : only print error messages. This is the default.</li>
<li><em>2</em> : also print warning messages.</li>
<li><em>3</em> : also print tracing messages.</li>
<li><em>4</em> : also print debugging messages.</li>
</ul></li>
<li><p><strong>-l</strong> <em>live</em> : changes the supervision directory of <em>service</em> to <em>live</em>. By default this will be <code>%%livedir%%</code>. The default can also be changed at compile time by passing the <code>--livedir=live</code> option to <code>./configure</code>. An existing absolute path is expected and should be within a writable filesystem - likely a RAM filesystem—see <a href="66-scandir.html">66-scandir</a>.</p></li>
<li><p><strong>-t</strong> : handles the <em>selection</em> of the given <em>tree</em>. This option is mandatory except if a tree was marked as &#8216;current&#39;—see <a href="66-tree.html">66-tree</a>.</p></li>
<li><p><strong>-T</strong> <em>timeout</em> : specify a timeout in milliseconds after which <em>66-svctl</em> will stop trying to reach the desired state of the <em>service</em>; defaults to <code>3000</code>. timeout is applied to each <em>service</em> of the <em>selection</em>. Separate timeouts for different services can be set in their respective <a href="frontend.html">frontend</a> files using the <code>@timeout‑up</code> or <code>@timeout‑down</code> key. The <a href="frontend.html">frontend</a> key is prioritized over this option.</p></li>
<li><p><strong>-n</strong> <em>death</em> : specifiy the maximum number of <em>service</em> death events that the supervisor will keep track of. If the <em>service</em> dies more than this number of times <em>66‑svctl</em> will stop trying to reach the desired state of the <em>service</em>. The <a href="frontend.html">frontend</a> key <code>@maxdeath</code> is prioritized over this option—see <a href="frontend.html">frontend</a>. If this option is not specified and no max-death-tally file exists then the maximum allowed deaths will be <code>5</code> by default.</p></li>
<li><p><strong>-u</strong> : send an up signal to <em>service</em>. It searches for a notification-fd file—see <a href="https://skarnet.org/software/s6/notifywhenup.html">service startup notifications</a> and <a href="frontend.html">frontend</a>. If this file exists <em>66‑svctl</em> will automatically change to uppercase <code>U</code>.</p></li>
<li><p><strong>-d</strong> : send a down signal to <em>service</em>. It searches for a notification‑fd file—see <a href="https://skarnet.org/software/s6/notifywhenup.html">service startup notifications</a> and <a href="frontend.html">frontend</a>. If this file exists <em>66‑svctl</em> will automatically change to uppercase <code>D</code>.</p></li>
<li><p><strong>-r</strong> : send a reload signal to <em>service</em>. By default the signal is a <code>SIGTERM</code>; this can be configured with the <code>@down-signal</code> field in the <a href="frontend.html">frontend</a> service file. It searches for a notification-fd file—see <a href="https://skarnet.org/software/s6/notifywhenup.html">service startup notifications</a> and <a href="frontend.html">frontend</a>. If this file exists <em>66‑svctl</em> will automatically change to uppercase <code>R</code>.</p></li>
<li><p><strong>-X</strong> : exit; the supervisor of the <em>service</em> will exit too. This command should normally never be used on a working system.</p></li>
<li><p><strong>-K</strong> : send a SIGKILL to <em>service</em> and keep it down. </p></li>
</ul>

<h2 id="s6-svc%20corresponding%20signal">s6-svc corresponding signal</h2>

<p>The <em>66‑svctl</em> signals correspond to <a href="https://skarnet.org/software/s6/s6-svc.html">s6‑svc</a> in the following manner:</p>

<ul>
<li><em>-u</em>  = -u</li>
<li><em>-U</em>  = -uwU</li>
<li><em>-d</em>  = -d</li>
<li><em>-D</em>  = -uwD</li>
<li><em>-r</em>  = -r</li>
<li><em>-X</em>  = -xd</li>
<li><em>-K</em>  = -kd</li>
</ul>

<h2 id="Notes">Notes</h2>

<p>You can also send a signal in a similar fashion to a <code>classic</code> or <code>longrun</code> service with the <a href="https://skarnet.org/software/s6/s6-svc.html">s6‑svc</a>  tool which has the philosophy &#8220;launch and forget&#8221; which unlike <em>66‑svctl</em> does not care for the exit status of the service when a signal is sent.</p>

<p>As an extra convenience the <strong>-n</strong> option allows to deal directly with <em>max-death-tally</em> from the command line even if it was not specified explicitely in the services <a href="frontend.html">frontend</a> file and no corresponding file exists.</p>
</body>
</html>
